<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenLedger - Universal Accounting Engine</title>
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- iOS Support -->
    <link rel="apple-touch-icon" href="icons/icon-192x192.png">
    <meta name="apple-mobile-web-app-status-bar" content="#2563eb">

    <!-- Theme Color -->
    <meta name="theme-color" content="#2563eb">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
   
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #34495e;
            --accent: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #2ecc71;
            --danger: #e74c3c;
            --warning: #f39c12;
            --info: #1abc9c;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
            flex: 1;
        }
        
        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .logo i {
            margin-right: 10px;
            font-size: 2rem;
        }
        
        .logo span {
            color: var(--accent);
        }
        
        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 2px solid var(--accent);
            overflow-x: auto;
            position: sticky;
            top: 68px;
            z-index: 99;
        }
        
        .tab {
            padding: 1rem 1.5rem;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            white-space: nowrap;
            display: flex;
            align-items: center;
        }
        
        .tab i {
            margin-right: 8px;
            font-size: 1.1rem;
        }
        
        .tab:hover {
            background: #f8f9fa;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--accent);
            color: var(--accent);
        }
        
        .tab-content {
            display: none;
            padding: 2rem;
            background: white;
            border-radius: 0 0 var(--border-radius) var(--border-radius);
            box-shadow: var(--box-shadow);
            min-height: 500px;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .tab-content.active {
            display: block;
        }
        
        .card {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            margin-bottom: 1.5rem;
            overflow: hidden;
            transition: var(--transition);
        }
        
        .card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(-2px);
        }
        
        .card-header {
            padding: 1rem 1.5rem;
            background: #f8f9fa;
            border-bottom: 1px solid #eee;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .card-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: var(--transition);
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }
        
        button {
            background: var(--accent);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }
        
        button i {
            margin-right: 8px;
        }
        
        button:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: var(--danger);
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .btn-success {
            background: var(--success);
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: var(--warning);
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }
        
        th, td {
            padding: 0.75rem;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background: #f8f9fa;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .debit {
            color: var(--success);
            font-weight: 500;
        }
        
        .credit {
            color: var(--danger);
            font-weight: 500;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: white;
            padding: 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
            text-align: center;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .stat-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            color: var(--accent);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            margin: 0.5rem 0;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9rem;
        }
        
        .filters {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .report-options {
            background: #f8f9fa;
            padding: 1rem;
            border-radius: var(--border-radius);
            margin-bottom: 1.5rem;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .close {
            font-size: 1.5rem;
            cursor: pointer;
            transition: var(--transition);
        }
        
        .close:hover {
            color: var(--danger);
            transform: rotate(90deg);
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            color: white;
            opacity: 0;
            transform: translateY(-10px);
            transition: var(--transition);
            z-index: 1100;
            display: flex;
            align-items: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        
        .notification i {
            margin-right: 10px;
            font-size: 1.2rem;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .notification.success {
            background: var(--success);
        }
        
        .notification.error {
            background: var(--danger);
        }
        
        .notification.warning {
            background: var(--warning);
        }
        
        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #666;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #ccc;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted #ccc;
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        footer {
            background: var(--dark);
            color: white;
            padding: 1.5rem 0;
            margin-top: 2rem;
            text-align: center;
        }
        
        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .version {
            font-size: 0.9rem;
            color: #bbb;
        }
        
        @media (max-width: 768px) {
            .stats {
                grid-template-columns: 1fr;
            }
            
            .filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                flex-direction: column;
                align-items: stretch;
            }
            
            .tab {
                padding: 0.75rem 1rem;
            }
            
            .modal-content {
                padding: 1rem;
                width: 95%;
            }
            
            .footer-content {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo"><i class="fas fa-book"></i>Open<span>Ledger</span></div>
                <div id="company-name">Company Name</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="nav-tabs">
            <div class="tab active" data-tab="dashboard"><i class="fas fa-tachometer-alt"></i>Dashboard</div>
            <div class="tab" data-tab="journal"><i class="fas fa-book"></i>Journal</div>
            <div class="tab" data-tab="ledger"><i class="fas fa-file-invoice-dollar"></i>Ledger</div>
            <div class="tab" data-tab="trial-balance"><i class="fas fa-balance-scale"></i>Trial Balance</div>
            <div class="tab" data-tab="reports"><i class="fas fa-chart-bar"></i>Reports</div>
            <div class="tab" data-tab="accounts"><i class="fas fa-chart-pie"></i>Chart of Accounts</div>
            <div class="tab" data-tab="settings"><i class="fas fa-cog"></i>Settings</div>
        </div>
        
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>Financial Overview</h2>
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-wallet"></i></div>
                    <div class="stat-value" id="total-assets">$0.00</div>
                    <div class="stat-label">Total Assets</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-hand-holding-usd"></i></div>
                    <div class="stat-value" id="total-liabilities">$0.00</div>
                    <div class="stat-label">Total Liabilities</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                    <div class="stat-value" id="total-equity">$0.00</div>
                    <div class="stat-label">Equity</div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-money-bill-wave"></i></div>
                    <div class="stat-value" id="net-income">$0.00</div>
                    <div class="stat-label">Net Income</div>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span>Recent Transactions</span>
                    <button id="refresh-dashboard"><i class="fas fa-sync-alt"></i>Refresh</button>
                </div>
                <div class="card-body">
                    <table id="recent-transactions">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Debit</th>
                                <th>Credit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="empty-state-row">
                                <td colspan="4" class="empty-state">
                                    <i class="fas fa-receipt"></i>
                                    <p>No transactions yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Journal Tab -->
        <div id="journal" class="tab-content">
            <h2>Journal Entries</h2>
            <button id="add-transaction-btn" style="margin-bottom: 1.5rem;"><i class="fas fa-plus"></i>Add New Transaction</button>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="journal-date-from">From:</label>
                    <input type="date" id="journal-date-from">
                </div>
                <div class="filter-group">
                    <label for="journal-date-to">To:</label>
                    <input type="date" id="journal-date-to">
                </div>
                <button id="apply-journal-filter"><i class="fas fa-filter"></i>Apply Filter</button>
                <button id="clear-journal-filter" class="btn-warning"><i class="fas fa-times"></i>Clear Filter</button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span>Journal Entries</span>
                    <div>
                        <span class="tooltip">
                            <i class="fas fa-info-circle"></i>
                            <span class="tooltiptext">Double-click on a transaction to edit it</span>
                        </span>
                        <button id="export-journal"><i class="fas fa-download"></i>Export</button>
                    </div>
                </div>
                <div class="card-body">
                    <table id="journal-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Account</th>
                                <th>Debit</th>
                                <th>Credit</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="empty-state-row">
                                <td colspan="6" class="empty-state">
                                    <i class="fas fa-book"></i>
                                    <p>No journal entries yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Ledger Tab -->
        <div id="ledger" class="tab-content">
            <h2>General Ledger</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="ledger-account">Account:</label>
                    <select id="ledger-account">
                        <option value="">Select Account</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="ledger-date-from">From:</label>
                    <input type="date" id="ledger-date-from">
                </div>
                <div class="filter-group">
                    <label for="ledger-date-to">To:</label>
                    <input type="date" id="ledger-date-to">
                </div>
                <button id="apply-ledger-filter"><i class="fas fa-filter"></i>Apply Filter</button>
                <button id="clear-ledger-filter" class="btn-warning"><i class="fas fa-times"></i>Clear Filter</button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span>General Ledger</span>
                    <button id="print-ledger"><i class="fas fa-print"></i>Print</button>
                </div>
                <div class="card-body">
                    <table id="ledger-table">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Description</th>
                                <th>Debit</th>
                                <th>Credit</th>
                                <th>Balance</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="empty-state-row">
                                <td colspan="5" class="empty-state">
                                    <i class="fas fa-file-invoice-dollar"></i>
                                    <p>Select an account to view ledger</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Trial Balance Tab -->
        <div id="trial-balance" class="tab-content">
            <h2>Trial Balance</h2>
            
            <div class="filters">
                <div class="filter-group">
                    <label for="tb-date">As of:</label>
                    <input type="date" id="tb-date">
                </div>
                <button id="generate-tb"><i class="fas fa-calculator"></i>Generate Trial Balance</button>
                <button id="export-tb"><i class="fas fa-download"></i>Export</button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <span>Trial Balance</span>
                    <span id="tb-status"></span>
                </div>
                <div class="card-body">
                    <table id="trial-balance-table">
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Debit</th>
                                <th>Credit</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="empty-state-row">
                                <td colspan="3" class="empty-state">
                                    <i class="fas fa-balance-scale"></i>
                                    <p>Generate trial balance to view data</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h2>Financial Reports</h2>
            
            <div class="report-options">
                <div class="form-group">
                    <label for="report-type">Report Type:</label>
                    <select id="report-type">
                        <option value="income-statement">Income Statement</option>
                        <option value="balance-sheet">Balance Sheet</option>
                        <option value="cash-flow">Cash Flow Statement</option>
                        <option value="changes-equity">Statement of Changes in Equity</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="report-style">Report Style:</label>
                    <select id="report-style">
                        <option value="standard">Standard</option>
                        <option value="comparative">Comparative</option>
                        <option value="common-size">Common Size</option>
                    </select>
                </div>
                
                <div class="filters">
                    <div class="filter-group">
                        <label for="report-period">Period:</label>
                        <select id="report-period">
                            <option value="monthly">Monthly</option>
                            <option value="quarterly">Quarterly</option>
                            <option value="annual">Annual</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="report-date">Date:</label>
                        <input type="date" id="report-date">
                    </div>
                    <button id="generate-report"><i class="fas fa-chart-bar"></i>Generate Report</button>
                    <button id="export-report"><i class="fas fa-download"></i>Export as CSV</button>
                    <button id="print-report"><i class="fas fa-print"></i>Print</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header" id="report-title">Report Preview</div>
                <div class="card-body">
                    <div id="report-content">
                        <div class="empty-state">
                            <i class="fas fa-chart-bar"></i>
                            <p>Select report options and generate to view</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chart of Accounts Tab -->
        <div id="accounts" class="tab-content">
            <h2>Chart of Accounts</h2>
            <button id="add-account-btn" style="margin-bottom: 1.5rem;"><i class="fas fa-plus"></i>Add New Account</button>
            
            <div class="card">
                <div class="card-header">
                    <span>Chart of Accounts</span>
                    <button id="refresh-accounts"><i class="fas fa-sync-alt"></i>Refresh</button>
                </div>
                <div class="card-body">
                    <table id="accounts-table">
                        <thead>
                            <tr>
                                <th>Code</th>
                                <th>Account Name</th>
                                <th>Type</th>
                                <th>Balance</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="empty-state-row">
                                <td colspan="5" class="empty-state">
                                    <i class="fas fa-chart-pie"></i>
                                    <p>No accounts yet</p>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        
        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2>Application Settings</h2>
            
            <div class="card">
                <div class="card-header">Accounting Configuration</div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="accounting-mode">Accounting Mode:</label>
                        <select id="accounting-mode">
                            <option value="double">Double-Entry</option>
                            <option value="single">Single-Entry</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="accounting-basis">Accounting Basis:</label>
                        <select id="accounting-basis">
                            <option value="accrual">Accrual Basis</option>
                            <option value="cash">Cash Basis</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="company-name-input">Company Name:</label>
                        <input type="text" id="company-name-input" placeholder="Enter company name">
                    </div>
                    
                    <div class="form-group">
                        <label for="base-currency">Base Currency:</label>
                        <select id="base-currency">
                            <option value="USD">US Dollar (USD)</option>
                            <option value="EUR">Euro (EUR)</option>
                            <option value="GBP">British Pound (GBP)</option>
                            <option value="JPY">Japanese Yen (JPY)</option>
                            <option value="CAD">Canadian Dollar (CAD)</option>
                            <option value="AUD">Australian Dollar (AUD)</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="financial-year">Financial Year Start:</label>
                        <input type="date" id="financial-year">
                    </div>
                    
                    <button id="save-settings"><i class="fas fa-save"></i>Save Settings</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">Data Management</div>
                <div class="card-body">
                    <button id="export-data" style="margin-right: 1rem;"><i class="fas fa-download"></i>Export All Data</button>
                    <button id="import-data" style="margin-right: 1rem;"><i class="fas fa-upload"></i>Import Data</button>
                    <button id="clear-data" class="btn-danger"><i class="fas fa-trash"></i>Clear All Data</button>
                </div>
            </div>
            
            <div class="card">
                <div class="card-header">Sample Data</div>
                <div class="card-body">
                    <p>Load sample data to test the application:</p>
                    <button id="load-sample-data" class="btn-success"><i class="fas fa-database"></i>Load Sample Data</button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">Security</div>
                <div class="card-body">
                    <div class="form-group">
                        <label for="auto-logout">Auto Logout (minutes):</label>
                        <input type="number" id="auto-logout" min="1" max="120" value="30">
                    </div>
                    <button id="change-password"><i class="fas fa-key"></i>Change Password</button>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div>OpenLedger &copy; 2023 | Universal Accounting Engine</div>
                <div class="version">v1.2.0</div>
            </div>
        </div>
    </footer>
    
    <!-- Transaction Modal -->
    <div id="transaction-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-plus-circle"></i> Add New Transaction</h3>
                <span class="close">&times;</span>
            </div>
            <form id="transaction-form">
                <div class="form-group">
                    <label for="transaction-date">Date:</label>
                    <input type="date" id="transaction-date" required>
                </div>
                
                <div class="form-group">
                    <label for="transaction-description">Description:</label>
                    <input type="text" id="transaction-description" placeholder="Enter description" required>
                </div>
                
                <div class="form-group">
                    <label for="debit-account">Debit Account:</label>
                    <select id="debit-account" required>
                        <option value="">Select Account</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="debit-amount">Debit Amount:</label>
                    <input type="number" id="debit-amount" step="0.01" min="0.01" placeholder="0.00" required>
                </div>
                
                <div class="form-group">
                    <label for="credit-account">Credit Account:</label>
                    <select id="credit-account" required>
                        <option value="">Select Account</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="credit-amount">Credit Amount:</label>
                    <input type="number" id="credit-amount" step="0.01" min="0.01" placeholder="0.00" required>
                </div>
                
                <div class="form-group">
                    <label for="narration">Narration:</label>
                    <textarea id="narration" placeholder="Additional details"></textarea>
                </div>
                
                <div class="form-group">
                    <button type="submit"><i class="fas fa-save"></i> Save Transaction</button>
                    <button type="button" id="cancel-transaction" style="background: #95a5a6; margin-left: 10px;"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Account Modal -->
    <div id="account-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="account-modal-title"><i class="fas fa-plus-circle"></i> Add New Account</h3>
                <span class="close">&times;</span>
            </div>
            <form id="account-form">
                <div class="form-group">
                    <label for="account-code">Account Code:</label>
                    <input type="text" id="account-code" placeholder="e.g., 1010" required>
                </div>
                
                <div class="form-group">
                    <label for="account-name">Account Name:</label>
                    <input type="text" id="account-name" placeholder="e.g., Cash" required>
                </div>
                
                <div class="form-group">
                    <label for="account-type">Account Type:</label>
                    <select id="account-type" required>
                        <option value="">Select Type</option>
                        <option value="Asset">Asset</option>
                        <option value="Liability">Liability</option>
                        <option value="Equity">Equity</option>
                        <option value="Revenue">Revenue</option>
                        <option value="Expense">Expense</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="account-subtype">Account Subtype:</label>
                    <select id="account-subtype">
                        <option value="">Select Subtype (Optional)</option>
                        <option value="Current Asset">Current Asset</option>
                        <option value="Fixed Asset">Fixed Asset</option>
                        <option value="Current Liability">Current Liability</option>
                        <option value="Long-term Liability">Long-term Liability</option>
                        <option value="Operating Revenue">Operating Revenue</option>
                        <option value="Non-operating Revenue">Non-operating Revenue</option>
                        <option value="Operating Expense">Operating Expense</option>
                        <option value="Non-operating Expense">Non-operating Expense</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="opening-balance">Opening Balance:</label>
                    <input type="number" id="opening-balance" step="0.01" placeholder="0.00">
                    <small>Positive for Assets/Expenses, Negative for Liabilities/Equity/Revenue</small>
                </div>
                
                <div class="form-group">
                    <button type="submit"><i class="fas fa-save"></i> Save Account</button>
                    <button type="button" id="cancel-account" style="background: #95a5a6; margin-left: 10px;"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Password Modal -->
    <div id="password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-key"></i> Change Password</h3>
                <span class="close">&times;</span>
            </div>
            <form id="password-form">
                <div class="form-group">
                    <label for="current-password">Current Password:</label>
                    <input type="password" id="current-password" required>
                </div>
                
                <div class="form-group">
                    <label for="new-password">New Password:</label>
                    <input type="password" id="new-password" required>
                </div>
                
                <div class="form-group">
                    <label for="confirm-password">Confirm Password:</label>
                    <input type="password" id="confirm-password" required>
                </div>
                
                <div class="form-group">
                    <button type="submit"><i class="fas fa-save"></i> Change Password</button>
                    <button type="button" id="cancel-password" style="background: #95a5a6; margin-left: 10px;"><i class="fas fa-times"></i> Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Notification -->
    <div id="notification" class="notification"></div>
    
    <!-- Hidden file input for import -->
    <input type="file" id="import-file" style="display: none;" accept=".json">
    
    <script>
        // Main application object
        const OpenLedger = {
            // Application state
            settings: {
                accountingMode: 'double',
                accountingBasis: 'accrual',
                companyName: 'Company Name',
                baseCurrency: 'USD',
                financialYear: new Date(new Date().getFullYear(), 0, 1).toISOString().split('T')[0],
                autoLogout: 30
            },
            accounts: [],
            transactions: [],
            idleTimer: null,
            
            // Initialize the application
            init() {
                this.loadData();
                this.setupEventListeners();
                this.renderAccounts();
                this.renderTransactions();
                this.updateDashboard();
                this.setCurrentDate();
                this.setupIdleTimer();
                
                // Add sample accounts if no accounts exist
                if (this.accounts.length === 0) {
                    this.createDefaultAccounts();
                }
            },
            
            // Setup idle timer for auto logout
            setupIdleTimer() {
                this.resetIdleTimer();
                
                // Events that reset the timer
                ['mousedown', 'keydown', 'touchstart'].forEach(event => {
                    document.addEventListener(event, () => {
                        this.resetIdleTimer();
                    });
                });
            },
            
            resetIdleTimer() {
                if (this.idleTimer) {
                    clearTimeout(this.idleTimer);
                }
                
                const timeout = this.settings.autoLogout * 60 * 1000;
                this.idleTimer = setTimeout(() => {
                    this.showNotification('You have been logged out due to inactivity', 'warning');
                    // In a real app, you would redirect to login
                }, timeout);
            },
            
            // Create default accounts if none exist
            createDefaultAccounts() {
                const defaultAccounts = [
                    { id: 'acc-1', code: '1010', name: 'Cash', type: 'Asset', subtype: 'Current Asset', openingBalance: 0 },
                    { id: 'acc-2', code: '1020', name: 'Accounts Receivable', type: 'Asset', subtype: 'Current Asset', openingBalance: 0 },
                    { id: 'acc-3', code: '1030', name: 'Inventory', type: 'Asset', subtype: 'Current Asset', openingBalance: 0 },
                    { id: 'acc-4', code: '2010', name: 'Accounts Payable', type: 'Liability', subtype: 'Current Liability', openingBalance: 0 },
                    { id: 'acc-5', code: '3010', name: 'Common Stock', type: 'Equity', subtype: '', openingBalance: 0 },
                    { id: 'acc-6', code: '4010', name: 'Sales Revenue', type: 'Revenue', subtype: 'Operating Revenue', openingBalance: 0 },
                    { id: 'acc-7', code: '5010', name: 'Cost of Goods Sold', type: 'Expense', subtype: 'Operating Expense', openingBalance: 0 },
                    { id: 'acc-8', code: '5020', name: 'Rent Expense', type: 'Expense', subtype: 'Operating Expense', openingBalance: 0 }
                ];
                
                this.accounts = defaultAccounts;
                this.saveData();
                this.renderAccounts();
            },
            
            // Load data from localStorage
            loadData() {
                try {
                    const settings = localStorage.getItem('openledger-settings');
                    const accounts = localStorage.getItem('openledger-accounts');
                    const transactions = localStorage.getItem('openledger-transactions');
                    
                    if (settings) this.settings = JSON.parse(settings);
                    if (accounts) this.accounts = JSON.parse(accounts);
                    if (transactions) this.transactions = JSON.parse(transactions);
                    
                    // Update UI with settings
                    document.getElementById('accounting-mode').value = this.settings.accountingMode;
                    document.getElementById('accounting-basis').value = this.settings.accountingBasis;
                    document.getElementById('company-name-input').value = this.settings.companyName;
                    document.getElementById('base-currency').value = this.settings.baseCurrency;
                    document.getElementById('financial-year').value = this.settings.financialYear;
                    document.getElementById('auto-logout').value = this.settings.autoLogout;
                    document.getElementById('company-name').textContent = this.settings.companyName;
                } catch (e) {
                    console.error('Error loading data from localStorage:', e);
                    this.showNotification('Error loading saved data', 'error');
                }
            },
            
            // Save data to localStorage
            saveData() {
                try {
                    localStorage.setItem('openledger-settings', JSON.stringify(this.settings));
                    localStorage.setItem('openledger-accounts', JSON.stringify(this.accounts));
                    localStorage.setItem('openledger-transactions', JSON.stringify(this.transactions));
                } catch (e) {
                    console.error('Error saving data to localStorage:', e);
                    this.showNotification('Error saving data', 'error');
                }
            },
            
            // Set current date in date fields
            setCurrentDate() {
                const today = new Date().toISOString().split('T')[0];
                const firstOfMonth = new Date();
                firstOfMonth.setDate(1);
                const firstOfMonthStr = firstOfMonth.toISOString().split('T')[0];
                
                document.getElementById('transaction-date').value = today;
                document.getElementById('journal-date-from').value = firstOfMonthStr;
                document.getElementById('journal-date-to').value = today;
                document.getElementById('ledger-date-from').value = firstOfMonthStr;
                document.getElementById('ledger-date-to').value = today;
                document.getElementById('tb-date').value = today;
                document.getElementById('report-date').value = today;
            },
            
            // Setup event listeners
            setupEventListeners() {
                // Tab navigation
                document.querySelectorAll('.tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                        
                        tab.classList.add('active');
                        document.getElementById(tab.dataset.tab).classList.add('active');
                    });
                });
                
                // Modal controls
                document.querySelectorAll('.close').forEach(close => {
                    close.addEventListener('click', () => {
                        document.querySelectorAll('.modal').forEach(modal => {
                            modal.style.display = 'none';
                        });
                    });
                });
                
                // Close modal when clicking outside
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) {
                            modal.style.display = 'none';
                        }
                    });
                });
                
                // Cancel buttons
                document.getElementById('cancel-transaction').addEventListener('click', () => {
                    document.getElementById('transaction-modal').style.display = 'none';
                });
                
                document.getElementById('cancel-account').addEventListener('click', () => {
                    document.getElementById('account-modal').style.display = 'none';
                });
                
                document.getElementById('cancel-password').addEventListener('click', () => {
                    document.getElementById('password-modal').style.display = 'none';
                });
                
                // Add transaction button
                document.getElementById('add-transaction-btn').addEventListener('click', () => {
                    document.getElementById('transaction-modal').style.display = 'flex';
                });
                
                // Add account button
                document.getElementById('add-account-btn').addEventListener('click', () => {
                    document.getElementById('account-modal-title').textContent = 'Add New Account';
                    document.getElementById('account-form').reset();
                    document.getElementById('account-modal').style.display = 'flex';
                });
                
                // Change password button
                document.getElementById('change-password').addEventListener('click', () => {
                    document.getElementById('password-modal').style.display = 'flex';
                });
                
                // Password form submission
                document.getElementById('password-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.changePassword();
                });
                
                // Save settings
                document.getElementById('save-settings').addEventListener('click', () => {
                    this.saveSettings();
                });
                
                // Transaction form submission
                document.getElementById('transaction-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addTransaction();
                });
                
                // Account form submission
                document.getElementById('account-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addAccount();
                });
                
                // Export data
                document.getElementById('export-data').addEventListener('click', () => {
                    this.exportData();
                });
                
                // Import data
                document.getElementById('import-data').addEventListener('click', () => {
                    document.getElementById('import-file').click();
                });
                
                document.getElementById('import-file').addEventListener('change', (e) => {
                    this.importData(e.target.files[0]);
                    e.target.value = ''; // Reset file input
                });
                
                // Clear data
                document.getElementById('clear-data').addEventListener('click', () => {
                    this.clearData();
                });
                
                // Load sample data
                document.getElementById('load-sample-data').addEventListener('click', () => {
                    this.loadSampleData();
                });
                
                // Generate trial balance
                document.getElementById('generate-tb').addEventListener('click', () => {
                    this.generateTrialBalance();
                });
                
                // Export trial balance
                document.getElementById('export-tb').addEventListener('click', () => {
                    this.exportTrialBalance();
                });
                
                // Apply journal filter
                document.getElementById('apply-journal-filter').addEventListener('click', () => {
                    this.renderTransactions();
                });
                
                // Clear journal filter
                document.getElementById('clear-journal-filter').addEventListener('click', () => {
                    document.getElementById('journal-date-from').value = '';
                    document.getElementById('journal-date-to').value = '';
                    this.renderTransactions();
                });
                
                // Export journal
                document.getElementById('export-journal').addEventListener('click', () => {
                    this.exportJournal();
                });
                
                // Apply ledger filter
                document.getElementById('apply-ledger-filter').addEventListener('click', () => {
                    this.renderLedger();
                });
                
                // Clear ledger filter
                document.getElementById('clear-ledger-filter').addEventListener('click', () => {
                    document.getElementById('ledger-account').value = '';
                    document.getElementById('ledger-date-from').value = '';
                    document.getElementById('ledger-date-to').value = '';
                    this.renderLedger();
                });
                
                // Print ledger
                document.getElementById('print-ledger').addEventListener('click', () => {
                    this.printLedger();
                });
                
                // Generate report
                document.getElementById('generate-report').addEventListener('click', () => {
                    this.generateReport();
                });
                
                // Export report
                document.getElementById('export-report').addEventListener('click', () => {
                    this.exportReport();
                });
                
                // Print report
                document.getElementById('print-report').addEventListener('click', () => {
                    this.printReport();
                });
                
                // Refresh dashboard
                document.getElementById('refresh-dashboard').addEventListener('click', () => {
                    this.updateDashboard();
                    this.showNotification('Dashboard refreshed', 'success');
                });
                
                // Refresh accounts
                document.getElementById('refresh-accounts').addEventListener('click', () => {
                    this.renderAccounts();
                    this.showNotification('Accounts refreshed', 'success');
                });
                
                // Real-time validation for debit/credit amounts
                document.getElementById('debit-amount').addEventListener('input', () => {
                    this.syncAmounts('debit');
                });
                
                document.getElementById('credit-amount').addEventListener('input', () => {
                    this.syncAmounts('credit');
                });
            },
            
            // Change password
            changePassword() {
                const currentPassword = document.getElementById('current-password').value;
                const newPassword = document.getElementById('new-password').value;
                const confirmPassword = document.getElementById('confirm-password').value;
                
                // Simple validation
                if (newPassword !== confirmPassword) {
                    this.showNotification('New passwords do not match', 'error');
                    return;
                }
                
                if (newPassword.length < 8) {
                    this.showNotification('Password must be at least 8 characters', 'error');
                    return;
                }
                
                // In a real application, you would verify the current password and update it
                this.showNotification('Password changed successfully', 'success');
                document.getElementById('password-modal').style.display = 'none';
                document.getElementById('password-form').reset();
            },
            
            // Save application settings
            saveSettings() {
                this.settings.accountingMode = document.getElementById('accounting-mode').value;
                this.settings.accountingBasis = document.getElementById('accounting-basis').value;
                this.settings.companyName = document.getElementById('company-name-input').value;
                this.settings.baseCurrency = document.getElementById('base-currency').value;
                this.settings.financialYear = document.getElementById('financial-year').value;
                this.settings.autoLogout = document.getElementById('auto-logout').value;
                
                document.getElementById('company-name').textContent = this.settings.companyName;
                this.saveData();
                this.setupIdleTimer();
                this.showNotification('Settings saved successfully', 'success');
            },
            
            // Sync debit and credit amounts to ensure they're equal
            syncAmounts(source) {
                if (this.settings.accountingMode === 'double') {
                    const debitAmount = document.getElementById('debit-amount');
                    const creditAmount = document.getElementById('credit-amount');
                    
                    if (source === 'debit' && debitAmount.value) {
                        creditAmount.value = parseFloat(debitAmount.value).toFixed(2);
                    } else if (source === 'credit' && creditAmount.value) {
                        debitAmount.value = parseFloat(creditAmount.value).toFixed(2);
                    }
                }
            },
            
            // Render accounts table and dropdowns
            renderAccounts() {
                const accountsTable = document.getElementById('accounts-table').querySelector('tbody');
                const debitAccountSelect = document.getElementById('debit-account');
                const creditAccountSelect = document.getElementById('credit-account');
                const ledgerAccountSelect = document.getElementById('ledger-account');
                
                // Clear existing options but keep first option
                debitAccountSelect.innerHTML = '<option value="">Select Account</option>';
                creditAccountSelect.innerHTML = '<option value="">Select Account</option>';
                ledgerAccountSelect.innerHTML = '<option value="">Select Account</option>';
                
                // Check if we have accounts
                if (this.accounts.length === 0) {
                    accountsTable.innerHTML = '<tr class="empty-state-row"><td colspan="5" class="empty-state"><i class="fas fa-chart-pie"></i><p>No accounts yet</p></td></tr>';
                    return;
                }
                
                // Remove empty state if it exists
                const emptyState = accountsTable.querySelector('.empty-state-row');
                if (emptyState) emptyState.remove();
                
                // Add accounts to dropdowns and table
                this.accounts.forEach(account => {
                    // Add to debit/credit dropdowns
                    const option = document.createElement('option');
                    option.value = account.id;
                    option.textContent = `${account.code} - ${account.name}`;
                    
                    debitAccountSelect.appendChild(option.cloneNode(true));
                    creditAccountSelect.appendChild(option.cloneNode(true));
                    ledgerAccountSelect.appendChild(option.cloneNode(true));
                    
                    // Add to accounts table
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${account.code}</td>
                        <td>${account.name}</td>
                        <td>${account.type}${account.subtype ? ` (${account.subtype})` : ''}</td>
                        <td>${this.formatCurrency(this.getAccountBalance(account.id))}</td>
                        <td>
                            <button class="btn-danger" data-account-id="${account.id}"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    `;
                    accountsTable.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                accountsTable.querySelectorAll('.btn-danger').forEach(button => {
                    button.addEventListener('click', () => {
                        const accountId = button.dataset.accountId;
                        this.deleteAccount(accountId);
                    });
                });
            },
            
            // Render transactions table
            renderTransactions() {
                const journalTable = document.getElementById('journal-table').querySelector('tbody');
                const dateFrom = document.getElementById('journal-date-from').value;
                const dateTo = document.getElementById('journal-date-to').value;
                
                // Check if we have transactions
                if (this.transactions.length === 0) {
                    journalTable.innerHTML = '<tr class="empty-state-row"><td colspan="6" class="empty-state"><i class="fas fa-book"></i><p>No journal entries yet</p></td></tr>';
                    return;
                }
                
                // Remove empty state if it exists
                const emptyState = journalTable.querySelector('.empty-state-row');
                if (emptyState) emptyState.remove();
                
                journalTable.innerHTML = '';
                
                // Filter transactions by date if specified
                const filteredTransactions = this.transactions.filter(transaction => {
                    if (dateFrom && transaction.date < dateFrom) return false;
                    if (dateTo && transaction.date > dateTo) return false;
                    return true;
                });
                
                if (filteredTransactions.length === 0) {
                    journalTable.innerHTML = '<tr class="empty-state-row"><td colspan="6" class="empty-state"><i class="fas fa-search"></i><p>No transactions found for selected filters</p></td></tr>';
                    return;
                }
                
                filteredTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${transaction.date}</td>
                        <td>${transaction.description}</td>
                        <td>${this.getAccountName(transaction.debitAccount)}</td>
                        <td class="debit">${this.formatCurrency(transaction.debitAmount)}</td>
                        <td class="credit">${this.formatCurrency(transaction.creditAmount)}</td>
                        <td>
                            <button class="btn-danger" data-transaction-id="${transaction.id}"><i class="fas fa-trash"></i> Delete</button>
                        </td>
                    `;
                    journalTable.appendChild(row);
                });
                
                // Add event listeners to delete buttons
                journalTable.querySelectorAll('.btn-danger').forEach(button => {
                    button.addEventListener('click', () => {
                        const transactionId = button.dataset.transactionId;
                        this.deleteTransaction(transactionId);
                    });
                });
            },
            
            // Render ledger
            renderLedger() {
                const ledgerTable = document.getElementById('ledger-table').querySelector('tbody');
                const accountId = document.getElementById('ledger-account').value;
                const dateFrom = document.getElementById('ledger-date-from').value;
                const dateTo = document.getElementById('ledger-date-to').value;
                
                ledgerTable.innerHTML = '';
                
                if (!accountId) {
                    ledgerTable.innerHTML = '<tr class="empty-state-row"><td colspan="5" class="empty-state"><i class="fas fa-file-invoice-dollar"></i><p>Select an account to view ledger</p></td></tr>';
                    return;
                }
                
                // Filter transactions for this account
                const accountTransactions = this.transactions.filter(transaction => {
                    if (transaction.debitAccount !== accountId && transaction.creditAccount !== accountId) return false;
                    if (dateFrom && transaction.date < dateFrom) return false;
                    if (dateTo && transaction.date > dateTo) return false;
                    return true;
                });
                
                if (accountTransactions.length === 0) {
                    ledgerTable.innerHTML = '<tr class="empty-state-row"><td colspan="5" class="empty-state"><i class="fas fa-search"></i><p>No transactions found for selected account and filters</p></td></tr>';
                    return;
                }
                
                let runningBalance = 0;
                const account = this.accounts.find(a => a.id === accountId);
                
                accountTransactions.forEach(transaction => {
                    const isDebit = transaction.debitAccount === accountId;
                    const amount = isDebit ? transaction.debitAmount : transaction.creditAmount;
                    
                    // Update running balance based on account type
                    if (account.type === 'Asset' || account.type === 'Expense') {
                        runningBalance += isDebit ? amount : -amount;
                    } else {
                        runningBalance += isDebit ? -amount : amount;
                    }
                    
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${transaction.date}</td>
                        <td>${transaction.description}</td>
                        <td class="${isDebit ? 'debit' : ''}">${isDebit ? this.formatCurrency(amount) : ''}</td>
                        <td class="${!isDebit ? 'credit' : ''}">${!isDebit ? this.formatCurrency(amount) : ''}</td>
                        <td>${this.formatCurrency(runningBalance)}</td>
                    `;
                    ledgerTable.appendChild(row);
                });
            },
            
            // Generate trial balance
            generateTrialBalance() {
                const tbTable = document.getElementById('trial-balance-table').querySelector('tbody');
                const asOfDate = document.getElementById('tb-date').value;
                const tbStatus = document.getElementById('tb-status');
                
                tbTable.innerHTML = '';
                tbStatus.textContent = 'Generating...';
                
                // Simulate processing time
                setTimeout(() => {
                    // Filter transactions up to the selected date
                    const filteredTransactions = this.transactions.filter(transaction => {
                        return transaction.date <= asOfDate;
                    });
                    
                    // Calculate balances for each account
                    const accountBalances = {};
                    
                    this.accounts.forEach(account => {
                        accountBalances[account.id] = {
                            debit: 0,
                            credit: 0,
                            type: account.type,
                            name: account.name,
                            code: account.code
                        };
                    });
                    
                    filteredTransactions.forEach(transaction => {
                        // Debit side
                        if (accountBalances[transaction.debitAccount]) {
                            accountBalances[transaction.debitAccount].debit += transaction.debitAmount;
                        }
                        
                        // Credit side
                        if (accountBalances[transaction.creditAccount]) {
                            accountBalances[transaction.creditAccount].credit += transaction.creditAmount;
                        }
                    });
                    
                    // Add rows to trial balance table
                    let totalDebit = 0;
                    let totalCredit = 0;
                    
                    this.accounts.forEach(account => {
                        const balance = accountBalances[account.id];
                        if (balance.debit === 0 && balance.credit === 0) return;
                        
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${account.code} - ${account.name}</td>
                            <td class="debit">${this.formatCurrency(balance.debit)}</td>
                            <td class="credit">${this.formatCurrency(balance.credit)}</td>
                        `;
                        tbTable.appendChild(row);
                        
                        totalDebit += balance.debit;
                        totalCredit += balance.credit;
                    });
                    
                    // Add total row
                    const totalRow = document.createElement('tr');
                    totalRow.innerHTML = `
                        <td><strong>Total</strong></td>
                        <td class="debit"><strong>${this.formatCurrency(totalDebit)}</strong></td>
                        <td class="credit"><strong>${this.formatCurrency(totalCredit)}</strong></td>
                    `;
                    tbTable.appendChild(totalRow);
                    
                    // Check if debits equal credits
                    if (totalDebit !== totalCredit) {
                        tbStatus.innerHTML = '<span style="color: var(--danger);"><i class="fas fa-exclamation-triangle"></i> Not Balanced</span>';
                        this.showNotification('Trial balance is not balanced!', 'error');
                    } else {
                        tbStatus.innerHTML = '<span style="color: var(--success);"><i class="fas fa-check-circle"></i> Balanced</span>';
                        this.showNotification('Trial balance generated successfully', 'success');
                    }
                }, 500);
            },
            
            // Export trial balance as CSV
            exportTrialBalance() {
                const tbTable = document.getElementById('trial-balance-table');
                if (tbTable.querySelector('.empty-state-row')) {
                    this.showNotification('No trial balance data to export', 'error');
                    return;
                }
                
                const reportTitle = 'Trial Balance';
                let csvContent = `${reportTitle}\nAs of: ${document.getElementById('tb-date').value}\n\n`;
                
                for (let i = 0; i < tbTable.rows.length; i++) {
                    const row = tbTable.rows[i];
                    let rowText = '';
                    for (let j = 0; j < row.cells.length; j++) {
                        rowText += '"' + row.cells[j].textContent.replace(/"/g, '""') + '",';
                    }
                    csvContent += rowText + '\n';
                }
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `Trial_Balance_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Trial balance exported successfully', 'success');
            },
            
            // Export journal as CSV
            exportJournal() {
                const journalTable = document.getElementById('journal-table');
                if (journalTable.querySelector('.empty-state-row')) {
                    this.showNotification('No journal data to export', 'error');
                    return;
                }
                
                const dateFrom = document.getElementById('journal-date-from').value;
                const dateTo = document.getElementById('journal-date-to').value;
                let dateRange = '';
                
                if (dateFrom && dateTo) {
                    dateRange = `From ${dateFrom} to ${dateTo}`;
                }
                
                let csvContent = `Journal Entries ${dateRange}\n\n`;
                
                for (let i = 0; i < journalTable.rows.length; i++) {
                    const row = journalTable.rows[i];
                    let rowText = '';
                    for (let j = 0; j < row.cells.length - 1; j++) { // Skip actions column
                        rowText += '"' + row.cells[j].textContent.replace(/"/g, '""') + '",';
                    }
                    csvContent += rowText + '\n';
                }
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `Journal_Entries_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Journal entries exported successfully', 'success');
            },
            
            // Print ledger
            printLedger() {
                const ledgerTable = document.getElementById('ledger-table');
                if (ledgerTable.querySelector('.empty-state-row')) {
                    this.showNotification('No ledger data to print', 'error');
                    return;
                }
                
                const accountId = document.getElementById('ledger-account').value;
                const account = this.accounts.find(a => a.id === accountId);
                const accountName = account ? `${account.code} - ${account.name}` : 'Selected Account';
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>Ledger - ${accountName}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #2c3e50; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
                            th { background-color: #f2f2f2; }
                            .debit { color: #2ecc71; }
                            .credit { color: #e74c3c; }
                            @media print {
                                body { padding: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        <h1>Ledger: ${accountName}</h1>
                        <p>Generated on: ${new Date().toLocaleDateString()}</p>
                        ${ledgerTable.outerHTML}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                
                setTimeout(() => {
                    printWindow.print();
                    printWindow.close();
                }, 250);
            },
            
            // Print report
            printReport() {
                const reportContent = document.getElementById('report-content');
                if (reportContent.textContent.includes('Select report options')) {
                    this.showNotification('No report data to print', 'error');
                    return;
                }
                
                const reportTitle = document.getElementById('report-title').textContent;
                
                const printWindow = window.open('', '_blank');
                printWindow.document.write(`
                    <html>
                    <head>
                        <title>${reportTitle}</title>
                        <style>
                            body { font-family: Arial, sans-serif; padding: 20px; }
                            h1 { color: #2c3e50; }
                            table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                            th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
                            th { background-color: #f2f2f2; }
                            .debit { color: #2ecc71; }
                            .credit { color: #e74c3c; }
                            @media print {
                                body { padding: 0; }
                            }
                        </style>
                    </head>
                    <body>
                        <h1>${reportTitle}</h1>
                        <p>Generated on: ${new Date().toLocaleDateString()}</p>
                        ${reportContent.innerHTML}
                    </body>
                    </html>
                `);
                printWindow.document.close();
                printWindow.focus();
                
                setTimeout(() => {
                    printWindow.print();
                    printWindow.close();
                }, 250);
            },
            
            // Generate financial report
            generateReport() {
                const reportType = document.getElementById('report-type').value;
                const reportStyle = document.getElementById('report-style').value;
                const reportDate = document.getElementById('report-date').value;
                const reportContent = document.getElementById('report-content');
                
                reportContent.innerHTML = '<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><p>Generating report...</p></div>';
                
                // Simulate processing time
                setTimeout(() => {
                    let reportHTML = '';
                    
                    switch (reportType) {
                        case 'income-statement':
                            reportHTML = this.generateIncomeStatement(reportDate, reportStyle);
                            break;
                        case 'balance-sheet':
                            reportHTML = this.generateBalanceSheet(reportDate, reportStyle);
                            break;
                        case 'cash-flow':
                            reportHTML = this.generateCashFlowStatement(reportDate, reportStyle);
                            break;
                        case 'changes-equity':
                            reportHTML = this.generateChangesInEquity(reportDate, reportStyle);
                            break;
                    }
                    
                    reportContent.innerHTML = reportHTML;
                    document.getElementById('report-title').textContent = this.getReportTitle(reportType, reportStyle);
                    
                    this.showNotification('Report generated successfully', 'success');
                }, 1000);
            },
            
            // Export report as CSV
            exportReport() {
                const reportContent = document.getElementById('report-content');
                if (reportContent.textContent.includes('Select report options')) {
                    this.showNotification('No report data to export', 'error');
                    return;
                }
                
                const reportTitle = document.getElementById('report-title').textContent;
                
                let csvContent = reportTitle + '\n\n';
                
                const tables = reportContent.querySelectorAll('table');
                tables.forEach(table => {
                    for (let i = 0; i < table.rows.length; i++) {
                        const row = table.rows[i];
                        let rowText = '';
                        for (let j = 0; j < row.cells.length; j++) {
                            rowText += '"' + row.cells[j].textContent.replace(/"/g, '""') + '",';
                        }
                        csvContent += rowText + '\n';
                    }
                    csvContent += '\n';
                });
                
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `${reportTitle.replace(/\s+/g, '_')}_${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Report exported successfully', 'success');
            },
            
            // Add a new transaction
            addTransaction() {
                const date = document.getElementById('transaction-date').value;
                const description = document.getElementById('transaction-description').value;
                const debitAccount = document.getElementById('debit-account').value;
                const debitAmount = parseFloat(document.getElementById('debit-amount').value);
                const creditAccount = document.getElementById('credit-account').value;
                const creditAmount = parseFloat(document.getElementById('credit-amount').value);
                const narration = document.getElementById('narration').value;
                
                // Validate form
                if (!date || !description || !debitAccount || !debitAmount || !creditAccount || !creditAmount) {
                    this.showNotification('Please fill all required fields', 'error');
                    return;
                }
                
                // Validate debit equals credit for double-entry
                if (this.settings.accountingMode === 'double' && debitAmount !== creditAmount) {
                    this.showNotification('Debit and Credit amounts must be equal for double-entry accounting', 'error');
                    return;
                }
                
                // Validate accounts are different
                if (debitAccount === creditAccount) {
                    this.showNotification('Debit and Credit accounts must be different', 'error');
                    return;
                }
                
                // Create transaction object
                const transaction = {
                    id: Date.now().toString(),
                    date,
                    description,
                    debitAccount,
                    debitAmount,
                    creditAccount,
                    creditAmount,
                    narration,
                    createdAt: new Date().toISOString()
                };
                
                // Add to transactions array
                this.transactions.push(transaction);
                
                // Save data and update UI
                this.saveData();
                this.renderTransactions();
                this.updateDashboard();
                
                // Close modal and reset form
                document.getElementById('transaction-modal').style.display = 'none';
                document.getElementById('transaction-form').reset();
                
                this.showNotification('Transaction added successfully', 'success');
            },
            
            // Add a new account
            addAccount() {
                const code = document.getElementById('account-code').value;
                const name = document.getElementById('account-name').value;
                const type = document.getElementById('account-type').value;
                const subtype = document.getElementById('account-subtype').value;
                const openingBalance = parseFloat(document.getElementById('opening-balance').value) || 0;
                
                // Validate form
                if (!code || !name || !type) {
                    this.showNotification('Please fill all required fields', 'error');
                    return;
                }
                
                // Check if account code already exists
                if (this.accounts.some(account => account.code === code)) {
                    this.showNotification('Account code already exists', 'error');
                    return;
                }
                
                // Create account object
                const account = {
                    id: 'acc-' + Date.now(),
                    code,
                    name,
                    type,
                    subtype,
                    openingBalance,
                    createdAt: new Date().toISOString()
                };
                
                // Add to accounts array
                this.accounts.push(account);
                
                // If there's an opening balance, create a transaction
                if (openingBalance !== 0) {
                    let debitAccount, creditAccount;
                    let amount = Math.abs(openingBalance);
                    
                    if (openingBalance > 0) {
                        if (['Asset', 'Expense'].includes(type)) {
                            debitAccount = account.id;
                            creditAccount = this.getEquityAccountId();
                        } else {
                            debitAccount = this.getEquityAccountId();
                            creditAccount = account.id;
                        }
                    } else {
                        // openingBalance is negative
                        if (['Asset', 'Expense'].includes(type)) {
                            debitAccount = this.getEquityAccountId();
                            creditAccount = account.id;
                        } else {
                            debitAccount = account.id;
                            creditAccount = this.getEquityAccountId();
                        }
                    }
                    
                    const transaction = {
                        id: Date.now().toString() + '-opening',
                        date: new Date().toISOString().split('T')[0],
                        description: `Opening balance for ${name}`,
                        debitAccount,
                        debitAmount: amount,
                        creditAccount,
                        creditAmount: amount,
                        narration: 'Opening balance',
                        createdAt: new Date().toISOString()
                    };
                    
                    this.transactions.push(transaction);
                }
                
                // Save data and update UI
                this.saveData();
                this.renderAccounts();
                this.renderTransactions();
                this.updateDashboard();
                
                // Close modal and reset form
                document.getElementById('account-modal').style.display = 'none';
                document.getElementById('account-form').reset();
                
                this.showNotification('Account added successfully', 'success');
            },
            
            // Delete a transaction
            deleteTransaction(transactionId) {
                if (confirm('Are you sure you want to delete this transaction?')) {
                    this.transactions = this.transactions.filter(t => t.id !== transactionId);
                    this.saveData();
                    this.renderTransactions();
                    this.updateDashboard();
                    this.showNotification('Transaction deleted successfully', 'success');
                }
            },
            
            // Delete an account
            deleteAccount(accountId) {
                // Check if account has transactions
                const hasTransactions = this.transactions.some(t => 
                    t.debitAccount === accountId || t.creditAccount === accountId
                );
                
                if (hasTransactions) {
                    this.showNotification('Cannot delete account with existing transactions', 'error');
                    return;
                }
                
                if (confirm('Are you sure you want to delete this account?')) {
                    this.accounts = this.accounts.filter(a => a.id !== accountId);
                    this.saveData();
                    this.renderAccounts();
                    this.showNotification('Account deleted successfully', 'success');
                }
            },
            
            // Update dashboard with summary information
            updateDashboard() {
                // Calculate total assets
                const totalAssets = this.calculateAccountTypeTotal('Asset');
                document.getElementById('total-assets').textContent = this.formatCurrency(totalAssets);
                
                // Calculate total liabilities
                const totalLiabilities = this.calculateAccountTypeTotal('Liability');
                document.getElementById('total-liabilities').textContent = this.formatCurrency(totalLiabilities);
                
                // Calculate equity
                const equity = this.calculateAccountTypeTotal('Equity');
                document.getElementById('total-equity').textContent = this.formatCurrency(equity);
                
                // Calculate net income (Revenue - Expenses)
                const revenue = this.calculateAccountTypeTotal('Revenue');
                const expenses = this.calculateAccountTypeTotal('Expense');
                const netIncome = revenue - expenses;
                document.getElementById('net-income').textContent = this.formatCurrency(netIncome);
                
                // Update recent transactions
                const recentTransactionsTable = document.getElementById('recent-transactions').querySelector('tbody');
                
                // Remove empty state if it exists
                const emptyState = recentTransactionsTable.querySelector('.empty-state-row');
                if (emptyState) emptyState.remove();
                
                // Show last 5 transactions
                const recentTransactions = this.transactions.slice(-5).reverse();
                
                if (recentTransactions.length === 0) {
                    recentTransactionsTable.innerHTML = '<tr class="empty-state-row"><td colspan="4" class="empty-state"><i class="fas fa-receipt"></i><p>No transactions yet</p></td></tr>';
                    return;
                }
                
                recentTransactionsTable.innerHTML = '';
                
                recentTransactions.forEach(transaction => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${transaction.date}</td>
                        <td>${transaction.description}</td>
                        <td class="debit">${this.formatCurrency(transaction.debitAmount)}</td>
                        <td class="credit">${this.formatCurrency(transaction.creditAmount)}</td>
                    `;
                    recentTransactionsTable.appendChild(row);
                });
            },
            
            // Export all data as JSON
            exportData() {
                const data = {
                    settings: this.settings,
                    accounts: this.accounts,
                    transactions: this.transactions,
                    exportDate: new Date().toISOString(),
                    version: '1.2.0'
                };
                
                const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                
                link.setAttribute('href', url);
                link.setAttribute('download', `openledger_backup_${new Date().toISOString().split('T')[0]}.json`);
                link.style.visibility = 'hidden';
                
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showNotification('Data exported successfully', 'success');
            },
            
            // Import data from JSON file
            importData(file) {
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    try {
                        const data = JSON.parse(e.target.result);
                        
                        if (confirm('Importing data will overwrite your current data. Continue?')) {
                            if (data.settings) this.settings = data.settings;
                            if (data.accounts) this.accounts = data.accounts;
                            if (data.transactions) this.transactions = data.transactions;
                            
                            this.saveData();
                            this.renderAccounts();
                            this.renderTransactions();
                            this.updateDashboard();
                            
                            // Update UI with settings
                            document.getElementById('accounting-mode').value = this.settings.accountingMode;
                            document.getElementById('accounting-basis').value = this.settings.accountingBasis;
                            document.getElementById('company-name-input').value = this.settings.companyName;
                            document.getElementById('base-currency').value = this.settings.baseCurrency;
                            document.getElementById('financial-year').value = this.settings.financialYear;
                            document.getElementById('auto-logout').value = this.settings.autoLogout;
                            document.getElementById('company-name').textContent = this.settings.companyName;
                            
                            this.showNotification('Data imported successfully', 'success');
                        }
                    } catch (error) {
                        console.error('Error importing data:', error);
                        this.showNotification('Error importing data: Invalid file format', 'error');
                    }
                };
                
                reader.onerror = () => {
                    this.showNotification('Error reading file', 'error');
                };
                
                reader.readAsText(file);
            },
            
            // Clear all data
            clearData() {
                if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                    localStorage.clear();
                    this.settings = {
                        accountingMode: 'double',
                        accountingBasis: 'accrual',
                        companyName: 'Company Name',
                        baseCurrency: 'USD',
                        financialYear: new Date(new Date().getFullYear(), 0, 1).toISOString().split('T')[0],
                        autoLogout: 30
                    };
                    this.accounts = [];
                    this.transactions = [];
                    this.saveData();
                    this.renderAccounts();
                    this.renderTransactions();
                    this.updateDashboard();
                    this.showNotification('All data has been cleared', 'success');
                }
            },
            
            // Load sample data
            loadSampleData() {
                if (confirm('Load sample data? This will add sample accounts and transactions.')) {
                    // Sample accounts
                    const sampleAccounts = [
                        { id: 'acc-1', code: '1010', name: 'Cash', type: 'Asset', subtype: 'Current Asset', openingBalance: 5000 },
                        { id: 'acc-2', code: '1020', name: 'Accounts Receivable', type: 'Asset', subtype: 'Current Asset', openingBalance: 2500 },
                        { id: 'acc-3', code: '1030', name: 'Inventory', type: 'Asset', subtype: 'Current Asset', openingBalance: 7000 },
                        { id: 'acc-4', code: '1040', name: 'Equipment', type: 'Asset', subtype: 'Fixed Asset', openingBalance: 15000 },
                        { id: 'acc-5', code: '2010', name: 'Accounts Payable', type: 'Liability', subtype: 'Current Liability', openingBalance: 3000 },
                        { id: 'acc-6', code: '2020', name: 'Loans Payable', type: 'Liability', subtype: 'Long-term Liability', openingBalance: 10000 },
                        { id: 'acc-7', code: '3010', name: 'Common Stock', type: 'Equity', subtype: '', openingBalance: 15000 },
                        { id: 'acc-8', code: '3020', name: 'Retained Earnings', type: 'Equity', subtype: '', openingBalance: 4500 },
                        { id: 'acc-9', code: '4010', name: 'Sales Revenue', type: 'Revenue', subtype: 'Operating Revenue', openingBalance: 0 },
                        { id: 'acc-10', code: '5010', name: 'Cost of Goods Sold', type: 'Expense', subtype: 'Operating Expense', openingBalance: 0 },
                        { id: 'acc-11', code: '5020', name: 'Rent Expense', type: 'Expense', subtype: 'Operating Expense', openingBalance: 0 },
                        { id: 'acc-12', code: '5030', name: 'Salaries Expense', type: 'Expense', subtype: 'Operating Expense', openingBalance: 0 }
                    ];
                    
                    // Sample transactions
                    const sampleTransactions = [
                        {
                            id: 'tx-1',
                            date: new Date(new Date().setDate(new Date().getDate() - 10)).toISOString().split('T')[0],
                            description: 'Sold goods to customer',
                            debitAccount: 'acc-1',
                            debitAmount: 1200,
                            creditAccount: 'acc-9',
                            creditAmount: 1200,
                            narration: 'Invoice #1001',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'tx-2',
                            date: new Date(new Date().setDate(new Date().getDate() - 8)).toISOString().split('T')[0],
                            description: 'Purchased inventory',
                            debitAccount: 'acc-3',
                            debitAmount: 800,
                            creditAccount: 'acc-5',
                            creditAmount: 800,
                            narration: 'Purchase order #2001',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'tx-3',
                            date: new Date(new Date().setDate(new Date().getDate() - 5)).toISOString().split('T')[0],
                            description: 'Paid rent',
                            debitAccount: 'acc-11',
                            debitAmount: 1000,
                            creditAccount: 'acc-1',
                            creditAmount: 1000,
                            narration: 'Monthly rent payment',
                            createdAt: new Date().toISOString()
                        },
                        {
                            id: 'tx-4',
                            date: new Date(new Date().setDate(new Date().getDate() - 3)).toISOString().split('T')[0],
                            description: 'Paid salaries',
                            debitAccount: 'acc-12',
                            debitAmount: 2500,
                            creditAccount: 'acc-1',
                            creditAmount: 2500,
                            narration: 'Bi-weekly payroll',
                            createdAt: new Date().toISOString()
                        }
                    ];
                    
                    this.accounts = sampleAccounts;
                    this.transactions = sampleTransactions;
                    this.saveData();
                    this.renderAccounts();
                    this.renderTransactions();
                    this.updateDashboard();
                    this.showNotification('Sample data loaded successfully', 'success');
                }
            },
            
            // Show notification
            showNotification(message, type) {
                const notification = document.getElementById('notification');
                let icon = '';
                
                switch (type) {
                    case 'success':
                        icon = '<i class="fas fa-check-circle"></i>';
                        break;
                    case 'error':
                        icon = '<i class="fas fa-exclamation-circle"></i>';
                        break;
                    case 'warning':
                        icon = '<i class="fas fa-exclamation-triangle"></i>';
                        break;
                }
                
                notification.innerHTML = `${icon} ${message}`;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.className = 'notification';
                }, 3000);
            },
            
            // Format currency amount
            formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: this.settings.baseCurrency
                }).format(amount);
            },
            
            // Get account name by ID
            getAccountName(accountId) {
                const account = this.accounts.find(a => a.id === accountId);
                return account ? `${account.code} - ${account.name}` : 'Unknown Account';
            },
            
            // Get account balance
            getAccountBalance(accountId) {
                const account = this.accounts.find(a => a.id === accountId);
                if (!account) return 0;
                
                let balance = account.openingBalance || 0;
                
                this.transactions.forEach(transaction => {
                    if (transaction.debitAccount === accountId) {
                        balance += transaction.debitAmount;
                    }
                    
                    if (transaction.creditAccount === accountId) {
                        balance -= transaction.creditAmount;
                    }
                });
                
                return balance;
            },
            
            // Calculate total for an account type
            calculateAccountTypeTotal(type) {
                return this.accounts
                    .filter(account => account.type === type)
                    .reduce((total, account) => total + this.getAccountBalance(account.id), 0);
            },
            
            // Get equity account ID (create one if it doesn't exist)
            getEquityAccountId() {
                let equityAccount = this.accounts.find(a => a.type === 'Equity' && a.name === 'Retained Earnings');
                
                if (!equityAccount) {
                    equityAccount = {
                        id: 'equity-' + Date.now(),
                        code: '3020',
                        name: 'Retained Earnings',
                        type: 'Equity',
                        openingBalance: 0,
                        createdAt: new Date().toISOString()
                    };
                    this.accounts.push(equityAccount);
                    this.saveData();
                }
                
                return equityAccount.id;
            },
            
            // Generate income statement
            generateIncomeStatement(asOfDate, style) {
                // Calculate revenue total
                const revenueAccounts = this.accounts.filter(a => a.type === 'Revenue');
                let revenueTotal = 0;
                
                revenueAccounts.forEach(account => {
                    revenueTotal += this.getAccountBalance(account.id);
                });
                
                // Calculate expense total
                const expenseAccounts = this.accounts.filter(a => a.type === 'Expense');
                let expenseTotal = 0;
                
                expenseAccounts.forEach(account => {
                    expenseTotal += this.getAccountBalance(account.id);
                });
                
                // Net income
                const netIncome = revenueTotal - expenseTotal;
                
                // Generate HTML table
                let html = `
                    <table>
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Revenue</strong></td>
                                <td></td>
                            </tr>
                `;
                
                // Add revenue accounts
                revenueAccounts.forEach(account => {
                    const balance = this.getAccountBalance(account.id);
                    if (balance !== 0) {
                        html += `
                            <tr>
                                <td>${account.name}</td>
                                <td>${this.formatCurrency(balance)}</td>
                            </tr>
                        `;
                    }
                });
                
                html += `
                            <tr>
                                <td><strong>Total Revenue</strong></td>
                                <td><strong>${this.formatCurrency(revenueTotal)}</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Expenses</strong></td>
                                <td></td>
                            </tr>
                `;
                
                // Add expense accounts
                expenseAccounts.forEach(account => {
                    const balance = this.getAccountBalance(account.id);
                    if (balance !== 0) {
                        html += `
                            <tr>
                                <td>${account.name}</td>
                                <td>${this.formatCurrency(balance)}</td>
                            </tr>
                        `;
                    }
                });
                
                html += `
                            <tr>
                                <td><strong>Total Expenses</strong></td>
                                <td><strong>${this.formatCurrency(expenseTotal)}</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Net Income</strong></td>
                                <td><strong>${this.formatCurrency(netIncome)}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                `;
                
                return html;
            },
            
            // Generate balance sheet
            generateBalanceSheet(asOfDate, style) {
                // Calculate totals
                const totalAssets = this.calculateAccountTypeTotal('Asset');
                const totalLiabilities = this.calculateAccountTypeTotal('Liability');
                const totalEquity = this.calculateAccountTypeTotal('Equity');
                
                // Calculate net income (Revenue - Expenses)
                const revenue = this.calculateAccountTypeTotal('Revenue');
                const expenses = this.calculateAccountTypeTotal('Expense');
                const netIncome = revenue - expenses;
                
                // Generate HTML table
                let html = `
                    <table>
                        <thead>
                            <tr>
                                <th>Account</th>
                                <th>Amount</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Assets</strong></td>
                                <td></td>
                            </tr>
                `;
                
                // Add asset accounts
                const assetAccounts = this.accounts.filter(a => a.type === 'Asset');
                assetAccounts.forEach(account => {
                    const balance = this.getAccountBalance(account.id);
                    if (balance !== 0) {
                        html += `
                            <tr>
                                <td>${account.name}</td>
                                <td>${this.formatCurrency(balance)}</td>
                            </tr>
                        `;
                    }
                });
                
                html += `
                            <tr>
                                <td><strong>Total Assets</strong></td>
                                <td><strong>${this.formatCurrency(totalAssets)}</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Liabilities</strong></td>
                                <td></td>
                            </tr>
                `;
                
                // Add liability accounts
                const liabilityAccounts = this.accounts.filter(a => a.type === 'Liability');
                liabilityAccounts.forEach(account => {
                    const balance = this.getAccountBalance(account.id);
                    if (balance !== 0) {
                        html += `
                            <tr>
                                <td>${account.name}</td>
                                <td>${this.formatCurrency(balance)}</td>
                            </tr>
                        `;
                    }
                });
                
                html += `
                            <tr>
                                <td><strong>Total Liabilities</strong></td>
                                <td><strong>${this.formatCurrency(totalLiabilities)}</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Equity</strong></td>
                                <td></td>
                            </tr>
                `;
                
                // Add equity accounts
                const equityAccounts = this.accounts.filter(a => a.type === 'Equity');
                equityAccounts.forEach(account => {
                    const balance = this.getAccountBalance(account.id);
                    if (balance !== 0) {
                        html += `
                            <tr>
                                <td>${account.name}</td>
                                <td>${this.formatCurrency(balance)}</td>
                            </tr>
                        `;
                    }
                });
                
                html += `
                            <tr>
                                <td>Retained Earnings</td>
                                <td>${this.formatCurrency(netIncome)}</td>
                            </tr>
                            <tr>
                                <td><strong>Total Equity</strong></td>
                                <td><strong>${this.formatCurrency(totalEquity + netIncome)}</strong></td>
                            </tr>
                            <tr>
                                <td><strong>Total Liabilities & Equity</strong></td>
                                <td><strong>${this.formatCurrency(totalLiabilities + totalEquity + netIncome)}</strong></td>
                            </tr>
                        </tbody>
                    </table>
                `;
                
                return html;
            },
            
            // Generate cash flow statement
            generateCashFlowStatement(asOfDate, style) {
                // Simplified implementation
                return `
                    <div class="empty-state">
                        <i class="fas fa-money-bill-wave"></i>
                        <p>Cash Flow Statement implementation would go here.</p>
                        <p>This would include operating, investing, and financing activities.</p>
                    </div>
                `;
            },
            
            // Generate changes in equity statement
            generateChangesInEquity(asOfDate, style) {
                // Simplified implementation
                return `
                    <div class="empty-state">
                        <i class="fas fa-chart-line"></i>
                        <p>Statement of Changes in Equity implementation would go here.</p>
                        <p>This would show changes in equity accounts over time.</p>
                    </div>
                `;
            },
            
            // Get report title based on type and style
            getReportTitle(type, style) {
                const titles = {
                    'income-statement': 'Income Statement',
                    'balance-sheet': 'Balance Sheet',
                    'cash-flow': 'Cash Flow Statement',
                    'changes-equity': 'Statement of Changes in Equity'
                };
                
                const styles = {
                    'standard': '',
                    'comparative': 'Comparative ',
                    'common-size': 'Common Size '
                };
                
                return styles[style] + titles[type];
            }
        };
        
        // Initialize the application when the DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            OpenLedger.init();
        });
    </script>
</body>
</html>